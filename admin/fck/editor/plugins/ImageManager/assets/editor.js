/**
 * Functions for the ImageEditor interface, used by editor.php only	
 * @author $Author: Wei Zhuo $
 * @author $Author: Frédéric Klee <fklee@isuisse.com> $ - constraints toggle and check
 * @author $Author: Paul Moers <mail@saulmade.nl> $ - watermarking and replace code + several small enhancements <http://www.saulmade.nl/FCKeditor/FCKPlugins.php>
 * @version $Id: editor.js 2006-04-09 $
 * @package ImageManager
 */
var current_action=null;var actions=["crop","scale","rotate","measure","save","watermark","replace"];var orginal_width=null,orginal_height=null;function toggle(g){if(current_action!=g){if(editor.window.document.getElementById("imgCanvas")){editor.window.document.getElementById("imgCanvas").style.display="block";editor.window.document.getElementById("background").style.display="none";if(editor.window.watermarkingEnabled==true){editor.window.dd.elements.floater.hide()}}for(var d in actions){if(actions[d]!=g){var j=document.getElementById("tools_"+actions[d]);j.style.display="none";var f=document.getElementById("icon_"+actions[d]);f.className=""}}current_action=g;var j=document.getElementById("tools_"+g);j.style.display="block";var f=document.getElementById("icon_"+g);f.className="iconActive";var c=document.getElementById("indicator_image");c.src="img/"+g+".gif";editor.setMode(current_action);if(g=="watermark"){if(editor.window.document.getElementById("imgCanvas")){editor.window.document.getElementById("imgCanvas").style.display="none";editor.window.document.getElementById("background").style.display="block";if(editor.window.watermarkingEnabled==true){editor.window.dd.elements.floater.show();editor.window.dd.elements.floater.moveTo(0,0);editor.window.verifyBounds()}}}if(g=="scale"){var a=editor.window.document.getElementById("theImage");orginal_width=a.width;orginal_height=a.height;var b=document.getElementById("sw");b.value=orginal_width;var e=document.getElementById("sh");e.value=orginal_height}}}function toggleMarker(){var a=document.getElementById("markerImg");if(a!=null&&a.src!=null){if(a.src.indexOf("t_black.gif")>=0){a.src="img/t_white.gif"}else{a.src="img/t_black.gif"}editor.toggleMarker()}}function toggleConstraints(){var a=document.getElementById("scaleConstImg");var b=document.getElementById("constProp");if(a!=null&&a.src!=null){if(a.src.indexOf("unlocked2.gif")>=0){a.src="img/islocked2.gif";b.checked=true;checkConstrains("width")}else{a.src="img/unlocked2.gif";b.checked=false}}}function checkConstrains(f){var e=document.getElementById("constProp");if(e.checked){var b=document.getElementById("sw");var d=b.value;var c=document.getElementById("sh");var a=c.value;if(orginal_width>0&&orginal_height>0){if(f=="width"&&d>0){c.value=parseInt((d/orginal_width)*orginal_height)}else{if(f=="height"&&a>0){b.value=parseInt((a/orginal_height)*orginal_width)}}}}updateMarker("scale")}function updateMarker(f){if(f=="crop"){var e=document.getElementById("cx");var d=document.getElementById("cy");var g=document.getElementById("cw");var b=document.getElementById("ch");editor.setMarker(parseInt(e.value),parseInt(d.value),parseInt(g.value),parseInt(b.value))}else{if(f=="scale"){var a=document.getElementById("sw");var c=document.getElementById("sh");editor.setMarker(0,0,parseInt(a.value),parseInt(c.value))}}}function rotatePreset(a){var b=a.options[a.selectedIndex].value;if(b.length>0&&parseInt(b)!=0){var c=document.getElementById("ra");c.value=parseInt(b)}}function updateFormat(c){var b=c.options[c.selectedIndex].value;var a=b.split(",");if(a.length>1){updateSlider(parseInt(a[1]))}}function doUpload(){var a=parent.document.getElementById("buttons");a.style.display="none";var c=parent.document.getElementById("tools_replace");c.style.display="none";parent.old=(parent.onbeforeunload)?parent.onbeforeunload:function(){};parent.onbeforeunload=function(){parent.old();alert(i18n("Please do not close the window while uploading a new image! If you do, the original image gets deleted!"));return false};var b=document.getElementById("uploadForm");if(b){showMessage("Uploading")}}function showMessage(a){var c=document.getElementById("message");var b=document.getElementById("messages");if(c.firstChild){c.removeChild(c.firstChild)}c.appendChild(document.createTextNode(i18n(a)));b.style.display="block"}function hideMessage(){var a=document.getElementById("messages");a.style.display="none"}function changeWatermark(source){if(editor.window.watermarkingEnabled){floater=editor.window.dd.elements.floater;floater.swapImage(eval("editor.window."+source.options[source.selectedIndex].value+"Preload.src"));floater.resizeTo(source.options[source.selectedIndex].getAttribute("x"),source.options[source.selectedIndex].getAttribute("y"));editor.window.verifyBounds()}}function changeWatermarkOpacity(a){if(editor.window.watermarkingEnabled){floater=editor.window.dd.elements.floater;floater.css.filter="alpha(opacity:"+a+")";floater.css.KHTMLopacity=a/100;floater.css.Mozopacity=a/100;floater.css.opacity=a/100}}function moveWatermark(a,b){if(editor.window.watermarkingEnabled){floater=editor.window.dd.elements.floater;background=editor.window.dd.elements.background;a=background.x+(background.w-floater.w)*a;b=background.y+(background.h-floater.h)*b;floater.moveTo(a,b)}}function colorWatermarkBG(a){if(background=editor.window.document.getElementById("background")){if(background.style.backgroundImage!=""&&background.style.backgroundImage!="url(img/backgroundGrid.gif)"){this.backgroundImage=background.style.backgroundImage}background.style.backgroundImage="";if(a==""){background.style.backgroundImage=this.backgroundImage;background.style.backgroundColor=""}else{if(a=="grid"){background.style.backgroundImage="url(img/backgroundGrid.gif)";background.style.backgroundColor=""}else{background.style.backgroundColor=a}}}}function i18n(a){if(I18N){return(I18N[a]||a)}else{return a}}function addEvent(d,c,a){if(d.addEventListener){d.addEventListener(c,a,true);return true}else{if(d.attachEvent){var b=d.attachEvent("on"+c,a);return b}else{return false}}}init=function(){var a=document.getElementById("bottom");if(window.opener){__dlg_init(a);__dlg_translate(I18N)}};addEvent(window,"load",init);